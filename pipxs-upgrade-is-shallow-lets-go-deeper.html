<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" property="og:description" content="Software installed in pipx‚Äôs managed virtual environments can get stale. How can we update those packages and their¬†dependencies?">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="https://jamescooke.info/theme/droidstrap.css">
        <link href='https://fonts.googleapis.com/css?family=Droid+Sans:400,700|Droid+Sans+Mono|Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>


        <title>Pipx‚Äôs upgrade is shallow, let‚Äôs go¬†deeper // James Cooke // Brighton-based Python developer</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width">
    </head>

    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <div class="fake"> </div>
        <div class="container">
            <div class="row">
                <header class="span3">
                    <h1 class="blogtitle">
                        <a href="https://jamescooke.info"><img id="profileimg" src="/images/coding_cooke_ltd.png" alt="James Cooke" ></a>James Cooke
                    </h1>
                    <nav>
                        <ul>
                                <li><a href="/">Home</a></li>
                                <li><a href="/pages/hello-my-name-is-james.html">About</a></li>
                                <li><a href="/feeds/all.atom.xml">Atom Feed</a></li>
                        </ul>
                    </nav>
                </header>

    <section class="span7 offset1 content">
        <article class="blogpost">
            <header>
                <h1>Pipx&#8217;s upgrade is shallow, let&#8217;s go&nbsp;deeper</h1>
                <p class="postdate" title="2024-03-07T00:00:00+00:00">- Posted Mar 07, 2024</p>
            </header>
            <div class='article-content'>
                <p>pipx has been managing my Python tools for almost a&nbsp;year.</p>
<p>But those tools are getting stale - new versions are out - I need to&nbsp;upgrade.</p>
<h2>üí™ Let&#8217;s upgrade&nbsp;this</h2>
<p>One of my favourite and most used Python tools installed in pipx is
<a href="https://pypi.org/project/frogmouth/">Frogmouth</a>. While working on some
documentation, I think I&#8217;ve spotted a bug in some Markdown rendering. So before
I report the bug, let&#8217;s ensure I&#8217;ve got the latest&nbsp;version.</p>
<p>Upgrading &#8220;Is Easy ‚Ñ¢Ô∏è&#8221;. Just use <code>pipx upgrade</code>:</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>upgrade<span class="w"> </span>frogmouth
</code></pre></div>

<p>We get a spinner, and&nbsp;then:</p>
<div class="highlight"><pre><span></span><code>frogmouth is already at latest version 0.9.2 (location: /home/james/.local/pipx/venvs/frogmouth)
</code></pre></div>

<p>Success! Nothing to do, end of blog&nbsp;post.</p>
<p>&#8230;</p>
<h2>üîé Let&#8217;s&nbsp;check</h2>
<p>Frogmouth is using <a href="https://pypi.org/project/textual/">Textual</a> and
<a href="https://pypi.org/project/rich/">rich</a> under the hood - so if I want to make
sure I&#8217;ve got the latest Markdown code, I need to ensure they&#8217;ve been upgraded&nbsp;too.</p>
<p>Let&#8217;s ask <code>pip</code> to tell us all versions of packages in the <code>frogmouth</code> virtual&nbsp;environment:</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>runpip<span class="w"> </span>frogmouth<span class="w"> </span>list
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Package</span><span class="w">            </span><span class="n">Version</span>
<span class="o">------------------</span><span class="w"> </span><span class="o">---------</span>
<span class="n">anyio</span><span class="w">              </span><span class="mf">3.7</span><span class="o">.</span><span class="mi">1</span>
<span class="n">certifi</span><span class="w">            </span><span class="mf">2023.7</span><span class="o">.</span><span class="mi">22</span>
<span class="n">frogmouth</span><span class="w">          </span><span class="mf">0.9</span><span class="o">.</span><span class="mi">2</span><span class="w">        </span><span class="err">üëà</span><span class="w"> </span><span class="n">Here</span><span class="s1">&#39;s Frogmouth at the latest version</span>
<span class="n">h11</span><span class="w">                </span><span class="mf">0.14</span><span class="o">.</span><span class="mi">0</span>
<span class="n">httpcore</span><span class="w">           </span><span class="mf">0.17</span><span class="o">.</span><span class="mi">3</span>
<span class="n">httpx</span><span class="w">              </span><span class="mf">0.24</span><span class="o">.</span><span class="mi">1</span>
<span class="n">idna</span><span class="w">               </span><span class="mf">3.4</span>
<span class="n">importlib</span><span class="o">-</span><span class="n">metadata</span><span class="w"> </span><span class="mf">6.8</span><span class="o">.</span><span class="mi">0</span>
<span class="n">linkify</span><span class="o">-</span><span class="n">it</span><span class="o">-</span><span class="n">py</span><span class="w">      </span><span class="mf">2.0</span><span class="o">.</span><span class="mi">2</span>
<span class="n">markdown</span><span class="o">-</span><span class="n">it</span><span class="o">-</span><span class="n">py</span><span class="w">     </span><span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span>
<span class="n">mdit</span><span class="o">-</span><span class="n">py</span><span class="o">-</span><span class="n">plugins</span><span class="w">    </span><span class="mf">0.4</span><span class="o">.</span><span class="mi">0</span>
<span class="n">mdurl</span><span class="w">              </span><span class="mf">0.1</span><span class="o">.</span><span class="mi">2</span>
<span class="n">pip</span><span class="w">                </span><span class="mf">24.0</span>
<span class="n">pkg_resources</span><span class="w">      </span><span class="mf">0.0</span><span class="o">.</span><span class="mi">0</span>
<span class="n">Pygments</span><span class="w">           </span><span class="mf">2.16</span><span class="o">.</span><span class="mi">1</span>
<span class="n">rich</span><span class="w">               </span><span class="mf">13.5</span><span class="o">.</span><span class="mi">2</span><span class="w">       </span><span class="err">üëà</span><span class="w"> </span><span class="n">rich</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mf">13.7</span><span class="o">.</span><span class="mi">1</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">PyPI</span>
<span class="n">setuptools</span><span class="w">         </span><span class="mf">69.1</span><span class="o">.</span><span class="mi">1</span>
<span class="n">sniffio</span><span class="w">            </span><span class="mf">1.3</span><span class="o">.</span><span class="mi">0</span>
<span class="n">textual</span><span class="w">            </span><span class="mf">0.43</span><span class="o">.</span><span class="mi">2</span><span class="w">       </span><span class="err">üëà</span><span class="w"> </span><span class="n">Textual</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mf">0.52</span><span class="o">.</span><span class="mi">1</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">PyPI</span>
<span class="n">typing_extensions</span><span class="w">  </span><span class="mf">4.7</span><span class="o">.</span><span class="mi">1</span>
<span class="n">uc</span><span class="o">-</span><span class="n">micro</span><span class="o">-</span><span class="n">py</span><span class="w">        </span><span class="mf">1.0</span><span class="o">.</span><span class="mi">2</span>
<span class="n">wheel</span><span class="w">              </span><span class="mf">0.42</span><span class="o">.</span><span class="mi">0</span>
<span class="n">xdg</span><span class="w">                </span><span class="mf">6.0</span><span class="o">.</span><span class="mi">0</span>
<span class="n">zipp</span><span class="w">               </span><span class="mf">3.16</span><span class="o">.</span><span class="mi">2</span>
</code></pre></div>

<p>Uho - rich and Textual didn&#8217;t get updated by doing <code>pipx upgrade</code>.</p>
<h2>ü§î This kinda makes&nbsp;sense</h2>
<p>When we have a virtual environment for a project and we run <code>pip upgrade</code>, it
<em>just</em> upgrades the package we request. It only upgrades dependencies if they
conflict with the newly upgraded package. This is called the &#8220;only-if-needed&#8221;
strategy and is <a href="https://pip.pypa.io/en/stable/user_guide/#only-if-needed-recursive-upgrade">documented in the pip User
Guide</a>.</p>
<p>But, given I&#8217;m a <a href="https://pypi.org/project/pip-tools/">pip-tools</a> addict, I
rarely call <code>pip</code> directly. Usually I blow away all of a project&#8217;s
requirements, rebuild them with <code>pip-compile</code> and then install all the new
freshness with <code>pip-sync</code>.</p>
<p>How can I get this &#8220;everything new&#8221; behaviour with <code>pipx</code>? I think there are
two&nbsp;options&#8230;</p>
<h2>Option 1: Tell pip to be&nbsp;eager</h2>
<p>Also listed in the pip User Guide is the &#8220;eager&#8221; option&nbsp;which:</p>
<blockquote>
<p>upgrades all dependencies regardless of whether they still satisfy the new
parent&nbsp;requirements.</p>
</blockquote>
<p>This sounds like what I&#8217;m looking&nbsp;for.</p>
<p>And, luckily, <code>pipx upgrade --help</code> shows us just what we&nbsp;need:</p>
<div class="highlight"><pre><span></span><code>--pip-args PIP_ARGS   Arbitrary pip arguments to pass directly to pip install/upgrade commands
</code></pre></div>

<p>Let&#8217;s try it by passing <code>--upgrade-strategy=eager</code>:</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>upgrade<span class="w"> </span>--pip-args<span class="o">=</span>--upgrade-strategy<span class="o">=</span>eager<span class="w"> </span>frogmouth
</code></pre></div>

<p>This, unfortunately, gives very little output regarding the packages being
updated. So let&#8217;s check them again with <code>pip list</code> (this time just grepping for
&#8216;rich&#8217; and&nbsp;&#8216;textual&#8217;):</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>runpip<span class="w"> </span>frogmouth<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;^rich|^textual&#39;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>rich               13.7.1   üéâ Yay - upgraded to latest.
textual            0.43.2   üòû boo - not upgraded to latest.
</code></pre></div>

<h3>üò¨ Textual ain&#8217;t gunna&nbsp;upgrade</h3>
<p>After &#8220;some&#8221; digging, it turns out that Textual isn&#8217;t going to upgrade when
installing / upgrading Frogmouth. That&#8217;s because Frogmouth has a <a href="https://python-poetry.org/docs/dependency-specification/#caret-requirements">caret
requirement</a>
in <a href="https://github.com/Textualize/frogmouth/blob/main/pyproject.toml#L31">its <code>pyproject.toml</code>
file</a>
which restricts Textual from being upgraded beyond <code>0.43</code>.</p>
<p>I only discovered this after pulling out <code>pip-tools</code> and running a clean
compile of the current Frogmouth requirements and diffing them to the output of
<code>pipx runpip frogmouth list</code>.</p>
<p>Personally, I think this kind of pinning is frustrating, especially in <a href="https://0ver.org/">zero
versioned</a> software. If something breaks I can apply any
pins required to get them to work - I don&#8217;t need the upstream maintainer to do
it for me. That just creates slowness and unnecessary&nbsp;confusion.</p>
<p>Anyway - back to the&nbsp;upgrades&#8230;</p>
<h2>Option 2: Hit it with a&nbsp;reinstall</h2>
<p>There is <em>another</em> way. That&#8217;s to ask pipx to do a reinstallation of the
software. As per <code>pipx reinstall --help</code>:</p>
<blockquote>
<p>Package is uninstalled, then installed with pipx install <span class="caps">PACKAGE</span> with the
same options used in the original install of <span class="caps">PACKAGE</span>.</p>
</blockquote>
<p>Warning: this is a bit of a lie. The <code>--python</code> option is not kept when doing
reinstall. But, this <em>does</em> allow for new versions of Python to be used after&nbsp;reinstalling.</p>
<p>Given that I&#8217;m not using the default Python version for pipx installs, I always
have to pass in my preferred&nbsp;Python:</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>reinstall<span class="w"> </span>frogmouth<span class="w"> </span>--python<span class="o">=</span>python3.12
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">uninstalled</span><span class="w"> </span><span class="nx">frogmouth</span><span class="p">!</span><span class="w"> </span><span class="err">‚ú®</span><span class="w"> </span><span class="err">üåü</span><span class="w"> </span><span class="err">‚ú®</span>
<span class="w">  </span><span class="nx">installed</span><span class="w"> </span><span class="kn">package</span><span class="w"> </span><span class="nx">frogmouth</span><span class="w"> </span><span class="m m-Double">0.9.2</span><span class="p">,</span><span class="w"> </span><span class="nx">installed</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Python</span><span class="w"> </span><span class="m m-Double">3.12.2</span>
<span class="w">  </span><span class="nx">These</span><span class="w"> </span><span class="nx">apps</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">globally</span><span class="w"> </span><span class="nx">available</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nx">frogmouth</span>
<span class="nx">done</span><span class="p">!</span><span class="w"> </span><span class="err">‚ú®</span><span class="w"> </span><span class="err">üåü</span><span class="w"> </span><span class="err">‚ú®</span>
</code></pre></div>

<p>And rich and Textual got to the same versions as before with&nbsp;&#8220;eager&#8221;:</p>
<div class="highlight"><pre><span></span><code>pipx<span class="w"> </span>runpip<span class="w"> </span>frogmouth<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;^rich|^textual&#39;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>rich               13.7.1
textual            0.43.2
</code></pre></div>

<h2>Which is&nbsp;best?</h2>
<p>My guess is you should use what you think is best for your&nbsp;workflow.</p>
<p>I&#8217;m aggressive with my upgrading, so I&#8217;m happy with the <code>pipx reinstall</code> route.
This also may give cleaner virtual environments since we shouldn&#8217;t get any
hanging dependencies in the scenario that a package stops using a particular&nbsp;dependency.</p>
<p>Also, during my experimentation, I accidentally installed a package off PyPI
called &#8220;eager&#8221; ü§¶. Luckily it didn&#8217;t run and the source doesn&#8217;t look malicious
to my trusting eye. But it&#8217;s this kind of mistake that&#8217;s nicely cleaned up
every time the virtual environment is recreated with <code>reinstall</code>.&nbsp;üòÖ</p>
            </div>
        </article>

        <hr />

        <p class="article-meta">
            &ndash;
            Posted in <a href="https://jamescooke.info/category/python.html">Python</a>
                with
tag                    <a href="https://jamescooke.info/tag/languagepython.html">language:python</a>
                <br>
                &ndash; Further reading:
                <ul>
                    <li>
                        <a href="https://jamescooke.info/why-isnt-the-uk-in-dst-yet.html">Why isn&#8217;t the <span class="caps">UK</span> in <span class="caps">DST</span>&nbsp;yet?!</a>
                        <p>British Summer Time is due to start this weekend. However, for some
reason, it&#8217;s three weeks after the usual <span class="caps">USA</span> switch over, rather than the
usual two. Why is this? And when will it happen&nbsp;again?</p></li>
                    <li>
                        <a href="https://jamescooke.info/an-ode-to-pipx.html">An Ode to&nbsp;pipx</a>
                        <p>Using pipx has improved my daily development experience&nbsp;considerably.</p></li>
                    <li>
                        <a href="https://jamescooke.info/pytests-cache-and-gitignore.html">Pytest&#8217;s cache and&nbsp;gitignore</a>
                        <p class="first last">Sanity checking Pytest&#8217;s <tt class="docutils literal">.gitignore</tt> files.</p>
</li>
                </ul>
        </p>

        <hr />


 
    </section>

            </div>
            <div class="row">
                <footer class="offset4 span7">
                    <p>&copy; James Cooke &ndash;
                        Built with <a href="https://github.com/jamescooke/droidstrap">Droidstrap theme</a>
                        for <a href="https://blog.getpelican.com/">Pelican</a>
                    </p>
                    <p>Licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_GB">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</p>
                </footer>
        </div>

    </body>
</html>